[TOC]

# FTP

## OS提供FTP工具

- 注意

  在Windows与Linux使用` cd /`符号效果不同：

  - Windows

    始终在FTP根目录

  - Linux

    进入系统根目录

### Microsoft FTP service

Windows系统自带FTP服务。

- 开启Windows FTP service

https://www.cnblogs.com/liangxuru/p/6148212.html

### vsFTPd

`very secure FTP daemon`。

- 该工具分为服务端`vsftpd`与客户端`vsftp`

#### 安装

``` shell
# yum -y install vsftpd
```

安装成功后，生成`/etc/vsftpd.conf`配置文件

#### 使用

可通过`lsnf -i:21`查看`vsftpd`使用情况。

- 防火墙开启21端口

  因为ftp默认的端口为21，而centos默认是没有开启的，所以要修改iptables文件

  ```shell
  [root@bogon ~]# vim /etc/sysconfig/iptables
  -A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT
  
  在行上面有22 -j ACCEPT 下面另起一行输入跟那行差不多的，只是把22换成21，然后：wq保存。
  
  还要运行下,重启iptables
  [root@bogon ~]# service iptables restart
  ```

#### command

``` shell
# 启动
$ service vsftpd start
# 停止
$ service vsftpd stop
# 重启
$ service vsftpd restart
# 检查状态
$ servcie vsftpd status
```

#### 设置TCP最大连接数与单IP最大限制

`vsftp`分为`standalone`与`xinetd`模式：

`standalone`适用于高并发环境；

`xinetd`适用于小并发环境；

> 前段时间生产环境使用FTP协议上传文件出现`421`错误。
>
> 由于难以获取生产环境机器数据，我们依靠网上对`421`错误描述与本地环境模拟重现，认为是并发量过大引起问题产生的。

- 修改`/etc/vsftod.conf`

  - `standalone`模式

    检查`max_clients`与`max_per_ip`，默认为无限制，仅在`standalone`模式下有效。

  - `xinetd`模式

    检查`instances`与`cps`参数。

    - `instances`

      接受一个大于或等于1的整数或`UNLIMITED`，设置可以同时运行的最大进程数。

    - `cps`

      设置连接速率。它有两个参数，第一个参数表示每秒可以处理的连接数；第二个参数表示处理停止处理多少秒后，继续处理*暂停处理*的连接。

- 查看运行模式

``` shell
chkconfig -A|grep vsftpd
```





#### 参考

https://blog.51cto.com/meiling/2071122

https://blog.csdn.net/sy1084462993/article/details/80571349